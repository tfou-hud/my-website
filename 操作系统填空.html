<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“ä½œç³»ç»Ÿ åœ¨çº¿ç­”é¢˜ç³»ç»Ÿï¼ˆå«å®æ—¶ç­”é¢˜å¡ï¼‰</title>

    <style>

        :root {
    /* ä¸»è‰²è°ƒç³»åˆ— - è“ç™½ */
    --primary: #1e88ff;           /* ä¸»è‰²ï¼ˆè“ï¼‰ */
    --primary-dark: #0b63d1;      /* æ·±è‰²ç‰ˆæœ¬ */
    --primary-light: #e6f4ff;     /* æµ…è‰²ç‰ˆæœ¬ */
    --primary-pale: #f0f8ff;      /* ææ·¡ç‰ˆæœ¬ */
    --primary-medium: #60a5fa;    /* ä¸­é—´è‰² */
    
    /* æ–‡å­—é¢œè‰²å±‚çº§ */
    --text-main: #0b2140;         /* ä¸»æ–‡å­— - æ·±è“/æµ·å†› */
    --text-sub: #516f8f;          /* æ¬¡çº§æ–‡å­— - è“ç° */
    --text-light: #8fa6c6;        /* è½»æ–‡å­— - æµ…è“ç° */
    --text-accent: #1e88ff;       /* å¼ºè°ƒæ–‡å­— - ä¸»è‰² */
    
    /* èƒŒæ™¯è‰²å±‚çº§ */
    --bg-body: #f8fbff;           /* é¡µé¢èƒŒæ™¯ - ææµ…è“ */
    --bg-card: #ffffff;           /* å¡ç‰‡èƒŒæ™¯ - çº¯ç™½ */
    --bg-hover: #f1f6ff;          /* æ‚¬åœèƒŒæ™¯ - æµ…è“ */
    --bg-active: #e6f4ff;         /* æ´»è·ƒèƒŒæ™¯ - ææ·¡è“ */
    
    /* è¾¹æ¡†è‰²å±‚çº§ */
    --border: #e6eefb;            /* å¸¸è§„è¾¹æ¡†ï¼ˆæ·¡è“ï¼‰ */
    --border-light: #f1f6ff;      /* è½»è¾¹æ¡† */
    --border-strong: #cfe3ff;     /* å¼ºè¾¹æ¡† */
    
    /* æˆåŠŸè‰²ç³»åˆ— */
    --success: #10b981;           /* æˆåŠŸè‰²ï¼ˆä¿ç•™ç»¿ï¼‰ */
    --success-light: #6ee7b7;     /* æµ…æˆåŠŸè‰² */
    --success-bg: #d1fae5;        /* æˆåŠŸèƒŒæ™¯ */
    --success-pale: #ecfdf5;      /* ææ·¡æˆåŠŸèƒŒæ™¯ */
    
    /* é”™è¯¯è‰²ç³»åˆ— */
    --error: #ef4444;             /* é”™è¯¯è‰²ï¼ˆä¿ç•™ï¼‰ */
    --error-light: #f87171;       /* æµ…é”™è¯¯è‰² */
    --error-bg: #fee2e2;          /* é”™è¯¯èƒŒæ™¯ */
    --error-pale: #fef2f2;        /* ææ·¡é”™è¯¯èƒŒæ™¯ */
    
    /* è­¦å‘Šè‰²ç³»åˆ— */
    --warning: #f59e0b;           /* è­¦å‘Šè‰² */
    --warning-light: #fbbf24;     /* æµ…è­¦å‘Šè‰² */
    --warning-bg: #fef3c7;        /* è­¦å‘ŠèƒŒæ™¯ */
    
    /* ä¸­ç«‹è‰²ç³»åˆ— */
    --gray-50: #f8fbff;
    --gray-100: #f1f6ff;
    --gray-200: #e6eefb;
    --gray-300: #d1dfee;
    --gray-400: #9fb3ce;
    --gray-500: #6b7f9b;
    --gray-600: #4a5e78;
    
    /* é˜´å½± */
    --shadow-sm: 0 1px 2px 0 rgba(10, 25, 45, 0.04);
    --shadow-md: 0 6px 20px -6px rgba(14,136,255,0.18), 0 2px 6px -2px rgba(10,25,45,0.06);
    --shadow-lg: 0 12px 30px -10px rgba(14,136,255,0.12), 0 6px 12px -6px rgba(10,25,45,0.06);
    
    /* åœ†è§’ */
    --radius: 12px;
    --radius-sm: 6px;
    --radius-lg: 16px;
    
    /* å¸ƒå±€ */
    --sidebar-width: 300px;
    --sidebar-collapsed-width: 56px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background-color: var(--bg-body);
    color: var(--text-main);
    line-height: 1.6;
    padding-bottom: 80px;
}

/* ==================== æ•´ä½“å¸ƒå±€ ==================== */
.page-wrapper {
    --effective-sidebar: var(--sidebar-width);
    max-width: 1200px;
    margin: 0 auto; /* æ°´å¹³å±…ä¸­ */
    padding: 0 15px;
    padding-right: calc(var(--effective-sidebar) + 40px); /* ç»™å›ºå®šä¾§æ é¢„ç•™ç©ºé—´ */
    display: flex;
    justify-content: center; /* ä¸»ä½“å±…ä¸­ */
    gap: 20px;
}

/* å½“ä¾§æ æŠ˜å æ—¶ï¼Œå‡å°å³ä¾§é¢„ç•™ç©ºé—´ */
body.sidebar-collapsed .page-wrapper { padding-right: calc(var(--sidebar-collapsed-width) + 40px); }

.main-content {
    flex-grow: 1;
    max-width: 880px;
    width: 100%;
    min-width: 320px;
}

/* é¡¶éƒ¨ Header */
.header-hero {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 50px 20px 70px;
    text-align: center;
    border-radius: 0 0 30px 30px;
    box-shadow: 0 10px 30px rgba(14,136,255,0.18);
    margin-bottom: -30px;
    /* å°†å¤´éƒ¨å†…å®¹ä¸ä¸»åŒºåŸŸå¯¹é½ï¼ˆè§†è§‰ä¸Šä»ä¸ºå…¨å®½èƒŒæ™¯ï¼‰ */
    display: flex; justify-content: center;
    position: relative;
    overflow: hidden;
}

.header-hero::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    border-radius: 50%;
}

.header-hero h1 { 
    font-size: 2rem; 
    margin-bottom: 15px; 
    font-weight: 700;
    position: relative;
    z-index: 2;
    letter-spacing: 0.5px;
}

.header-hero p { 
    opacity: 0.95; 
    font-size: 1rem;
    position: relative;
    z-index: 2;
    letter-spacing: 0.3px;
    line-height: 1.5;
}

/* è®¡åˆ†æ¿ */
.score-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 20px;
    text-align: center;
    box-shadow: var(--shadow-md);
    margin-bottom: 30px;
    position: relative;
    z-index: 10;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid var(--border-light);
    transition: all 0.3s ease;
}

.score-card:hover {
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-light);
}

.score-info { text-align: left; }
.score-info span { display: block; color: var(--text-light); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; }
.score-info strong { font-size: 1.1rem; color: var(--text-main); margin-top: 4px; }

.final-score {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary);
    display: none;
}

/* è®¡æ—¶å™¨æ ·å¼ */
.timer-widget {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border-radius: var(--radius);
    padding: 12px 16px;
    box-shadow: var(--shadow-md);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-weight: 600;
    margin: 12px 0 16px 0;
    position: relative;
    overflow: hidden;
    flex-direction: column;
    text-align: center;
}

.timer-widget::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.timer-icon {
    font-size: 1.3rem;
    animation: pulse 2s ease-in-out infinite;
    position: relative;
    z-index: 1;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.timer-label {
    font-size: 0.8rem;
    opacity: 0.9;
    position: relative;
    z-index: 1;
}

.timer-display {
    font-size: 1.5rem;
    font-weight: 800;
    font-family: 'Courier New', monospace;
    position: relative;
    z-index: 1;
}

/* é¢˜å‹æ ‡é¢˜ */
.section-badge {
    display: inline-block;
    background: var(--primary-dark);
    color: white;
    padding: 8px 16px;
    border-radius: var(--radius-sm);
    font-size: 0.9rem;
    margin: 30px 0 15px;
    font-weight: 600;
    scroll-margin-top: 50px;
    letter-spacing: 0.3px;
}

/* é¢˜ç›®å¡ç‰‡ */
.question-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: var(--shadow-sm);
    border: 2px solid var(--border-light);
    transition: all 0.3s ease;
    scroll-margin-top: 70px;
    position: relative;
}

.question-card:hover {
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    transform: translateY(-2px);
    border-color: var(--primary-light);
}

.question-text {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--text-main);
    letter-spacing: 0.2px;
}
.q-tag {
    font-size: 0.75rem; 
    color: var(--primary); 
    background: var(--primary-pale);
    padding: 4px 8px; 
    border-radius: 4px; 
    margin-right: 8px; 
    vertical-align: middle;
    font-weight: 600;
}

/* é€‰é¡¹æ ·å¼ */
.options-group { display: flex; flex-direction: column; gap: 10px; }
.option-label {
    position: relative; display: flex; align-items: center;
    padding: 14px 16px; border: 2px solid var(--border);
    border-radius: 8px; cursor: pointer; transition: all 0.2s ease; background: var(--bg-card);
}

.option-label:hover {
    border-color: var(--primary-medium);
    background-color: var(--bg-active);
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.option-label input { position: absolute; opacity: 0; cursor: pointer; height: 0; width: 0; }
.checkmark {
    height: 20px; width: 20px; background-color: var(--bg-card);
    border: 2px solid var(--gray-300); border-radius: 50%; margin-right: 15px; flex-shrink: 0;
    position: relative; transition: all 0.2s;
}
input[type="checkbox"] ~ .checkmark { border-radius: 4px; }
.option-label:has(input:checked) { 
    border-color: var(--primary); 
    background-color: var(--primary-pale);
    box-shadow: 0 2px 8px rgba(79, 70, 229, 0.15);
}
.option-label input:checked ~ .checkmark { background-color: var(--primary); border-color: var(--primary); }
.option-label input:checked ~ .checkmark::after { content: ""; position: absolute; display: block; }
input[type="radio"] ~ .checkmark::after { top: 5px; left: 5px; width: 6px; height: 6px; border-radius: 50%; background: white; }
input[type="checkbox"] ~ .checkmark::after { left: 6px; top: 2px; width: 4px; height: 9px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg); }

/* ç»“æœåé¦ˆ */
.result-box {
    margin-top: 15px; 
    padding: 12px 16px; 
    border-radius: var(--radius-sm);
    font-size: 0.9rem; 
    display: none; 
    animation: fadeIn 0.3s ease;
    border-left: 4px solid transparent;
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
.question-card.correct { border-color: var(--success); }
.question-card.correct .result-box { 
    background-color: var(--success-pale); 
    color: #047857; 
    border-color: var(--success);
    border-left-color: var(--success);
}
.question-card.incorrect { border-color: var(--error); }
.question-card.incorrect .result-box { 
    background-color: var(--error-pale); 
    color: #dc2626; 
    border-color: var(--error);
    border-left-color: var(--error);
}

/* å¡«ç©ºé¢˜è¾“å…¥æ¡†æ ·å¼ */
.fill-in-input {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.fill-input-field {
    flex: 1;
    padding: 14px 16px;
    border: 2px solid var(--border);
    border-radius: 8px;
    font-size: 1rem;
    background-color: var(--bg-card);
    color: var(--text-primary);
    transition: all 0.2s ease;
}

.fill-input-field:focus {
    outline: none;
    border-color: var(--primary);
    background-color: var(--bg-active);
    box-shadow: 0 0 0 3px rgba(30, 136, 255, 0.1);
}

.fill-input-field::placeholder {
    color: var(--gray-400);
}

/* ==================== ç­”é¢˜å¡å¯¼èˆªæ  ==================== */
.sidebar {
    width: var(--sidebar-width);
    position: fixed;
    right: 20px;
    top: 20px;
    height: calc(100vh - 40px);
    padding: 20px 16px;
    background: var(--bg-card);
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    overflow: hidden;
    z-index: 120;
    transition: width 0.22s ease, right 0.22s ease;
}

.sidebar.collapsed { width: var(--sidebar-collapsed-width); }
.sidebar .nav-section .question-nav-grid { padding-right: 6px; }

/* Toggle button */
.sidebar-toggle {
    position: absolute;
    left: -22px;
    top: 16px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid var(--border);
    background: var(--bg-card);
    box-shadow: var(--shadow-sm);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: var(--text-main);
    transform: rotate(0deg);
    transition: all 0.18s ease;
}

.sidebar-toggle:hover {
    border-color: var(--primary);
    color: var(--primary);
    box-shadow: 0 2px 8px rgba(79, 70, 229, 0.15);
}
.sidebar.collapsed .sidebar-toggle { transform: rotate(180deg); }

/* æ‰‹æœºç«¯ä¾§æ å…³é—­æŒ‰é’® */
.mobile-close-btn {
    display: none;
    position: absolute;
    top: 12px;
    right: 12px;
    width: 36px;
    height: 36px;
    border-radius: 6px;
    border: 1px solid var(--border-light);
    background: var(--bg-card);
    color: var(--text-main);
    box-shadow: var(--shadow-sm);
    cursor: pointer;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
}
.mobile-close-btn:hover { border-color: var(--primary); color: var(--primary-dark); box-shadow: 0 4px 12px rgba(0,0,0,0.12); }

.sidebar h3 {
    font-size: 1.1rem;
    margin-bottom: 15px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--primary);
    color: var(--primary);
    font-weight: 700;
    letter-spacing: 0.5px;
}

.question-nav-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: flex-start;
}

.nav-section { margin-bottom: 10px; }
.nav-section-title { font-size: 0.95rem; color: var(--text-main); margin-bottom: 8px; font-weight: 700; letter-spacing: 0.3px; }
.nav-section hr { margin: 8px 0; border: none; height: 1px; background: var(--border); }

/* æ¯ä¸ªå°èŠ‚å†…çš„å¯¼èˆªç½‘æ ¼ç‹¬ç«‹å¯æ»šåŠ¨ï¼Œä¼˜åŒ–å°ºå¯¸ */
.nav-section .question-nav-grid {
    max-height: calc((100vh - 140px) / 2);
    overflow-y: auto;
    padding: 6px; /* ç»™å†…éƒ¨ç•™ç™½ */
    gap: 8px;
}

/* æŠ˜å æ€éšè—å°èŠ‚æ ‡é¢˜å¹¶è®©ç½‘æ ¼å¡«æ»¡ */
.sidebar.collapsed .nav-section-title { display: none; }
.sidebar.collapsed .nav-section .question-nav-grid { max-height: calc(100vh - 56px); }

.q-nav-button {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    width: 36px;
    height: 36px;
    border-radius: 6px;
    background-color: var(--gray-100); /* æœªä½œç­”é¢œè‰² */
    color: var(--text-light);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.18s ease;
    text-decoration: none;
    flex-shrink: 0;
    font-size: 0.95rem;
    border: 2px solid var(--gray-200);
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.q-nav-button:hover {
    background-color: var(--gray-200);
    color: var(--text-main);
    border-color: var(--gray-300);
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}

.q-nav-button.answered {
    background-color: var(--primary);
    color: white;
    border-color: var(--primary);
    box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
}

/* å½“ä¾§æ æŠ˜å ï¼ŒæŒ‰é’®å†ç´§å‡‘ä¸€äº› */
.sidebar.collapsed .q-nav-button { width: 32px; height: 32px; font-size: 0.88rem; }

/* æ›´ç´§å‡‘çš„å¤šé€‰/å•é€‰åŒºåˆ†æ ·å¼ï¼ˆå¯ç»§ç»­è°ƒæ•´ï¼‰ */
/* .q-nav-button.nav-single { } */
/* .q-nav-button.nav-multi { } */

/* æäº¤åçš„çŠ¶æ€ */
.q-nav-button.correct {
    background-color: var(--success);
    color: white;
    border-color: var(--success);
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
}
.q-nav-button.incorrect {
    background-color: var(--error);
    color: white;
    border-color: var(--error);
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

/* åº•éƒ¨å›ºå®šæ“ä½œæ  */
.bottom-bar {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--bg-card);
    padding: 15px;
    box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
    display: flex; 
    justify-content: center; 
    gap: 15px; 
    z-index: 100;
    border-top: 1px solid var(--border);
}

.btn {
    padding: 12px 30px; 
    border-radius: 30px; 
    font-weight: 600; 
    cursor: pointer;
    border: none; 
    transition: all 0.2s ease;
    font-size: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.12);
}

.btn:active {
    transform: translateY(0px);
}

.btn-primary {
    background-color: var(--primary); 
    color: white;
    box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3); 
    flex: 1; 
    max-width: 300px;
}

.btn-primary:hover {
    background-color: var(--primary-dark);
}

.btn-secondary { 
    background-color: var(--bg-hover); 
    color: var(--text-main);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    background-color: var(--gray-200);
    border-color: var(--border-strong);
}

/* åª’ä½“æŸ¥è¯¢ï¼šé€‚é…ä¸­å°å±ä¸å¾®å±ï¼Œå¢å¼ºå“åº”å¼ä½“éªŒ */
@media (max-width: 1200px) {
    .page-wrapper { max-width: 100%; padding: 0 12px; }
}

@media (max-width: 1000px) {
    .page-wrapper {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
        padding-bottom: 140px; /* ç»™åº•éƒ¨å›ºå®šæ ç•™å‡ºç©ºé—´ */
        padding: 0 12px 140px 12px;
    }
    
    .sidebar {
        display: none !important;
        position: fixed;
        right: -85vw;
        top: 0;
        width: 85vw;
        height: 100vh;
        background: var(--bg-card);
        border-radius: 0;
        z-index: 999;
        padding: 20px;
        overflow-y: auto;
        box-shadow: -4px 0 12px rgba(0,0,0,0.15);
        transition: right 0.3s ease;
        max-width: 85vw;
        box-sizing: border-box;
    }
    
    .sidebar.mobile-open {
        display: block !important;
        right: 0;
    }
    
    .sidebar-toggle {
        left: auto;
        right: 20px;
        top: 20px;
        width: 40px;
        height: 40px;
        z-index: 1001;
    }
    
    /* æ‰“å¼€ç­”é¢˜å¡æ—¶çš„é¡µé¢è’™å±‚ */
    body.sidebar-open {
        overflow: hidden;
    }
    
    body.sidebar-open::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.3);
        z-index: 998;
        animation: fadeIn 0.3s ease;
    }
    
    .mobile-answer-card-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .main-content {
        max-width: 100%;
        min-width: auto;
    }
    .header-hero { padding: 28px 16px 40px; }
    .header-hero h1 { font-size: 1.4rem; }
    .score-card { padding: 16px; flex-direction: column; gap: 8px; align-items: flex-start; }
    .question-card { padding: 18px; }
    .question-text { font-size: 1rem; }
    .option-label { padding: 10px 12px; }
    .checkmark { margin-right: 12px; height: 18px; width: 18px; }
    .q-nav-button { width: 36px; height: 36px; }
    .bottom-bar { flex-direction: column; gap: 10px; padding: 12px; }
    .btn { width: 100%; max-width: none; }
}

@media (max-width: 480px) {
    html { font-size: 14px; }
    .header-hero { padding: 22px 12px 28px; }
    .header-hero h1 { font-size: 1.25rem; }
    .timer-widget { padding: 10px 12px; margin: 8px 0 12px 0; }
    .timer-icon { font-size: 1.1rem; }
    .timer-label { font-size: 0.75rem; }
    .timer-display { font-size: 1.3rem; }
    .score-card { padding: 12px; }
    .section-badge { font-size: 0.85rem; padding: 5px 10px; }
    .question-card { padding: 14px; }
    .question-text { font-size: 0.98rem; margin-bottom: 12px; }
    .option-label { padding: 10px; }
    .options-group { gap: 8px; }
    
    /* æ‰‹æœºåº•éƒ¨æŒ‰é’®æ ä¼˜åŒ– */
    .bottom-bar { 
        padding: 8px; 
        gap: 6px;
        flex-wrap: wrap;
    }
    .btn { 
        padding: 10px 12px; 
        border-radius: 8px;
        font-size: 0.9rem;
        flex: 1;
        min-width: 70px;
    }
    
    .mobile-answer-card-btn {
        min-width: unset !important;
    }
    
    /* æ‰‹æœºç­”é¢˜å¡ä¼˜åŒ– */
    .sidebar {
        width: 100% !important;
        max-width: 100% !important;
        right: -100% !important;
        padding: 16px;
    }

    .sidebar.mobile-open {
        right: 0 !important;
    }
    
    .sidebar h3 {
        font-size: 1rem;
        margin-bottom: 12px;
        padding-bottom: 10px;
    }
    
    .q-nav-button {
        width: 32px;
        height: 32px;
        font-size: 0.85rem;
    }
}

/* ==================== å†å²è®°å½•æ¨¡æ€æ¡†æ ·å¼ ==================== */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
    animation: fadeIn 0.3s ease;
}

.modal-content {
    background-color: var(--bg-card);
    margin: 5% auto;
    padding: 0;
    border-radius: var(--radius);
    width: 90%;
    max-width: 900px;
    max-height: 85vh;
    box-shadow: var(--shadow-md);
    display: flex;
    flex-direction: column;
}

.modal-header {
    padding: 20px 24px;
    border-bottom: 2px solid var(--primary);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    background: var(--bg-active);
}

.modal-header h2 {
    margin: 0;
    color: var(--primary-dark);
    font-size: 1.5rem;
    font-weight: 700;
}

.modal-close {
    background: none;
    border: none;
    font-size: 2rem;
    color: var(--text-sub);
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s;
}

.modal-close:hover {
    background-color: var(--bg-body);
    color: var(--text-main);
}

.modal-body {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
}

.history-controls {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border);
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.history-item {
    background: var(--bg-card);
    border-radius: var(--radius-sm);
    padding: 16px;
    border: 1px solid var(--border-light);
    transition: all 0.2s;
}

.history-item:hover {
    box-shadow: var(--shadow-md);
    border-color: var(--primary-light);
    background-color: var(--bg-active);
}

.history-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.history-item-title {
    font-weight: 600;
    color: var(--text-main);
    font-size: 1.1rem;
}

.history-item-date {
    color: var(--text-sub);
    font-size: 0.9rem;
}

.history-item-score {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary);
    background: var(--primary-pale);
    padding: 4px 12px;
    border-radius: var(--radius-sm);
}

.history-item-delete {
    background: var(--error);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
    font-weight: 600;
}

.history-item-delete:hover {
    background: var(--error-light);
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

.option-stats {
    margin-top: 20px;
    padding: 16px;
    background: var(--primary-pale);
    border-radius: var(--radius-sm);
    border: 1px solid var(--primary-light);
}

.option-stats h3 {
    margin: 0 0 12px 0;
    color: var(--primary-dark);
    font-size: 1.1rem;
    font-weight: 700;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
}

.stat-item {
    background: var(--bg-card);
    padding: 14px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-light);
    transition: all 0.2s;
}

.stat-item:hover {
    box-shadow: var(--shadow-sm);
    border-color: var(--primary-light);
}

.stat-item-label {
    font-weight: 700;
    color: var(--text-main);
    margin-bottom: 6px;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    color: var(--text-light);
}

.stat-item-value {
    color: var(--primary);
    font-size: 1.3rem;
    font-weight: 800;
}

@media (max-width: 768px) {
    .modal-content {
        width: 95%;
        margin: 2% auto;
        max-height: 96vh;
    }
    .modal-header h2 {
        font-size: 1.2rem;
    }
    .history-item-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    .stats-grid {
        grid-template-columns: 1fr;
    }
}



    </style>

</head>
<body>

    <header class="header-hero">
        <h1>æ“ä½œç³»ç»Ÿå¡«ç©º</h1>
        <p>å¡«ç©ºé¢˜ 48 é“ Â· æ»¡åˆ† 100 åˆ†</p>
    </header>

    <div class="page-wrapper">
        <div class="main-content">
            <div class="score-card">
                <div class="score-info">
                    <span>å½“å‰è¿›åº¦</span>
                    <strong id="progress-text">0 / 48 é¢˜å·²ä½œç­”</strong>
                </div>
                <div class="final-score" id="finalScore">
                    å¾—åˆ†ï¼š0
                </div>
            </div>

            <form id="quizForm">
                <div class="section-badge" id="sc_title">ä¸€ã€å¡«ç©ºé¢˜ (å…±48é¢˜ï¼Œæ¯é¢˜çº¦2åˆ†)</div>
                <div id="single-choice-container">
                    </div>

                <!-- å¤šé¡¹é€‰æ‹©é¢˜éƒ¨åˆ†å·²ç§»é™¤ -->
            </form>
        </div>

        <div class="sidebar" id="sidebar">
            <button id="sidebar-toggle" class="sidebar-toggle" aria-expanded="true" title="æ”¶èµ·/å±•å¼€ç­”é¢˜å¡">â€º</button>
                <button class="mobile-close-btn" id="mobileCloseBtn" onclick="closeMobileSidebar()" aria-label="å…³é—­ç­”é¢˜å¡" title="å…³é—­ç­”é¢˜å¡" style="display:none;">âœ•</button>
                
            <!-- è®¡æ—¶å™¨ç»„ä»¶ - æ”¾åœ¨ç­”é¢˜å¡æœ€ä¸Šæ–¹ -->
            <div class="timer-widget" id="timerWidget">
                <div class="timer-icon">â±ï¸</div>
                <div class="timer-label">ç­”é¢˜ç”¨æ—¶</div>
                <div class="timer-display" id="timerDisplay">00:00</div>
            </div>
                
                <h3>ç­”é¢˜å¡</h3>

            <div class="nav-section">
                <div class="nav-section-title">å•é¡¹é€‰æ‹©</div>
                <div class="question-nav-grid" id="question-navigator-single"></div>
            </div>

            <!-- å¤šé¡¹é€‰æ‹©å¯¼èˆªå·²ç§»é™¤ -->
        </div>
    </div>

    <div class="bottom-bar">
        <button type="button" class="btn btn-secondary" onclick="resetQuiz()">é‡ç½®è¯•å·</button>
        <div style="display:flex;align-items:center;gap:8px;">
            <select id="shuffleMode" style="padding:10px;border-radius:12px;border:1px solid var(--border);background:white;">
                <option value="shuffleQuestions">æ‰“ä¹±é¢˜åºï¼ˆä»…é¢˜åºï¼‰</option>
                <option value="shuffleOptions">æ‰“ä¹±é€‰é¡¹ï¼ˆåºå·å›ºå®šï¼‰</option>
                <option value="shuffleBoth">é¢˜åº + é€‰é¡¹ï¼ˆå…¨éƒ¨æ‰“ä¹±ï¼‰</option>
            </select>
            <button type="button" class="btn btn-secondary" onclick="applyShuffle()">åº”ç”¨æ‰“ä¹±</button>
            <button type="button" class="btn btn-secondary" onclick="restoreOriginal()">æ¢å¤åŸçŠ¶</button>
        </div>
        <button type="button" class="btn btn-secondary mobile-answer-card-btn" id="mobileAnswerCardBtn" onclick="toggleMobileSidebar()" style="display:none;">
            <span>ğŸ“‹</span>
            <span>ç­”é¢˜å¡</span>
        </button>
        <button type="button" class="btn btn-primary" onclick="submitQuiz()">æäº¤è¯•å· & æŸ¥çœ‹å¾—åˆ†</button>
        <button type="button" id="btnShowHistory" class="btn btn-secondary" onclick="showHistory()">æŸ¥çœ‹å†å²è®°å½•</button>
    </div>

    <!-- å†å²è®°å½•æ¨¡æ€æ¡† -->
    <div id="historyModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç­”é¢˜å†å²è®°å½•</h2>
                <button class="modal-close" onclick="closeHistory()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="history-controls">
                    <button type="button" class="btn btn-secondary" onclick="clearAllHistory()">ä¸€é”®åˆ é™¤æ‰€æœ‰è®°å½•</button>
                    <div class="option-stats" id="optionStats"></div>
                </div>
                <div id="historyList" class="history-list"></div>
            </div>
        </div>
    </div>

    <script >
        // ================= å…¨å±€å˜é‡ =================
let quizStartTime = null; // è®°å½•ç­”é¢˜å¼€å§‹æ—¶é—´

        // ================= æ•°æ®æº =================
let fillBlankData = [
    { id: 1, q: "æºç¨‹åºç»è¿‡ç¼–è¯‘æˆ–è€…æ±‡ç¼–ç”Ÿæˆçš„æœºå™¨æŒ‡ä»¤é›†åˆï¼Œç§°ä¸º____ç¨‹åºã€‚", ans: "ç›®æ ‡" },
    { id: 2, q: "ç¨‹åºå‘˜ç¼–å†™ç¨‹åºæ—¶æ‰€ä½¿ç”¨çš„åœ°å€ç§°ä¸º____ã€‚", ans: "é€»è¾‘åœ°å€" },
    { id: 3, q: "ç£ç›˜æ•°æ®çš„è¯»å†™å•ä½æ˜¯____ã€‚", ans: "å—" },
    { id: 4, q: "ä¿¡å·é‡åˆå€¼ä¸º3ï¼Œå½“å‰å€¼ä¸º-1æ—¶ï¼Œè¡¨ç¤ºæ­£åœ¨ä½¿ç”¨èµ„æºçš„è¿›ç¨‹æ•°é‡ä¸º____ã€‚", ans: "3" },
    { id: 5, q: "æ®µå¼å­˜å‚¨ç®¡ç†ä»¥____ä¸ºå•ä½è¿›è¡Œå­˜å‚¨ç©ºé—´çš„ç®¡ç†ã€‚", ans: "æ®µ" },
    { id: 6, q: "æœ€æœ‰ä»£è¡¨æ€§çš„é¿å…æ­»é”ç®—æ³•æ˜¯Dijkstraçš„ ____ç®—æ³•ã€‚", ans: "é“¶è¡Œå®¶" },
    { id: 7, q: "è§£å†³è¿›ç¨‹é—´åŒæ­¥å’Œäº’æ–¥é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•ä¸º____å’ŒPVæ“ä½œã€‚", ans: "ä¿¡å·é‡" },
    { id: 8, q: "ä¿¡ç®±é€šä¿¡æœºåˆ¶é€šå¸¸é‡‡ç”¨____åŸè¯­å’Œæ¥æ”¶åŸè¯­æ¥å®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚", ans: "å‘é€" },
    { id: 9, q: "æ“ä½œç³»ç»Ÿæ˜¯å·¥ä½œåœ¨è£¸æœºä¸Šçš„ç¬¬ä¸€å±‚è½¯ä»¶ï¼ŒæŒ‰ç…§è½¯ä»¶çš„åˆ†ç±»å±äº____è½¯ä»¶ã€‚", ans: "ç³»ç»Ÿ" },
    { id: 10, q: "æ­»é”äº§ç”Ÿçš„ä¸»è¦åŸå› æœ‰è¿›ç¨‹é—´ç«äº‰èµ„æºä¸è¿›ç¨‹____ã€‚", ans: "æ¨è¿›é¡ºåºéæ³•" },
    { id: 11, q: "è™šæ‹Ÿè®¾å¤‡æ˜¯é€šè¿‡ ____æŠ€æœ¯æŠŠç‹¬äº«çš„è®¾å¤‡å˜æˆèƒ½ä¸ºè‹¥å¹²ç”¨æˆ·å…±äº«çš„è®¾å¤‡ã€‚", ans: "SPOOLing" },
    { id: 12, q: "ç°ä»£æ“ä½œç³»ç»Ÿè¿è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½æ˜¯____ã€‚", ans: "çº¿ç¨‹" },
    { id: 13, q: "____æ˜¯æŒ‡ç”¨æˆ·è°ƒç”¨çš„è®¾å¤‡å’Œå®é™…ç‰©ç†è®¾å¤‡æ— å…³ã€‚", ans: "è®¾å¤‡ç‹¬ç«‹æ€§" },
    { id: 14, q: "åœ¨è®¾å¤‡ç®¡ç†ä¸­ï¼Œ____ç”¨æ¥è¡¨æ˜è®¾å¤‡çš„ç±»å‹ã€‚", ans: "è®¾å¤‡ç±»å‹ç " },
    { id: 15, q: "åœ¨å®ç°äº†è®¾å¤‡ç‹¬ç«‹æ€§çš„ç³»ç»Ÿä¸­ï¼ŒI/Oè¿›ç¨‹ç”³è¯·è®¾å¤‡æ˜¯ä»¥ ____è®¾å¤‡å·æ¥ç”³è¯·çš„ã€‚", ans: "é€»è¾‘" },
    { id: 16, q: "é€šå¸¸å°†å¹¶å‘è¿›ç¨‹ä¹‹é—´çš„åˆ¶çº¦å…³ç³»åˆ†ä¸ºä¸¤ç±»:____å’Œäº’æ–¥ã€‚", ans: "åŒæ­¥" },
    { id: 17, q: "æŒ‰ç…§æ–‡ä»¶æ€§è´¨å’Œç”¨é€”åˆ†ç±»å¯åˆ†ä¸º____ã€åº“æ–‡ä»¶å’Œç”¨æˆ·æ–‡ä»¶ã€‚", ans: "ç³»ç»Ÿæ–‡ä»¶" },
    { id: 18, q: "è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç åŒºç§°ä¸º____ã€‚", ans: "ä¸´ç•ŒåŒº" },
    { id: 19, q: "è¿›ç¨‹è°ƒåº¦å¯åˆ†ä¸ºé«˜çº§è°ƒåº¦ã€ä¸­çº§è°ƒåº¦å’Œ____ã€‚", ans: "ä½çº§è°ƒåº¦" },
    { id: 20, q: "signalæ“ä½œå”¤é†’ä¸€ä¸ªç­‰å¾…è¿›ç¨‹æ—¶ï¼Œè¢«å”¤é†’è¿›ç¨‹è¿›å…¥____æ€ã€‚", ans: "å°±ç»ª" },
    { id: 21, q: "ä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®çš„èµ„æºç§°ä¸º____èµ„æºã€‚", ans: "ä¸´ç•Œ" },
    { id: 22, q: "æ­»é”äº§ç”Ÿçš„ä¸»è¦åŸå› æœ‰è¿›ç¨‹é—´____ä¸è¿›ç¨‹æ¨è¿›é¡ºåºéæ³•ã€‚", ans: "ç«äº‰èµ„æº" },
    { id: 23, q: "è¿›ç¨‹çš„ç‰¹å¾åŒ…æ‹¬åŠ¨æ€æ€§ã€____ã€ç‹¬ç«‹æ€§ã€å¼‚æ­¥æ€§å’Œç»“æ„æ€§ã€‚", ans: "å¹¶å‘æ€§" },
    { id: 24, q: "æ“ä½œç³»ç»Ÿæ‰€è®¿é—®çš„å®é™…å†…å­˜åœ°å€ç§°ä¸º____ã€‚", ans: "ç‰©ç†åœ°å€" },
    { id: 25, q: "ä»æ ¹ç›®å½•å¼€å§‹åˆ°æŒ‡å®šæ–‡ä»¶çš„è·¯å¾„æ˜¯ ____è·¯å¾„ã€‚", ans: "ç»å¯¹" },
    { id: 26, q: "åœ¨å›ºå®šåˆ†åŒºç®¡ç†ä¸­ï¼Œåˆ†åŒºä¸­æœªè¢«åˆ©ç”¨çš„ä¸€éƒ¨åˆ†åŒºåŸŸç§°ä¸º____ç¢ç‰‡ã€‚", ans: "å†…" },
    { id: 27, q: "windowsç³»ç»Ÿä¸­ç³»ç»Ÿæ–‡ä»¶çš„åç¼€ä¸€èˆ¬ä¸º ____ã€‚", ans: ".sys" },
    { id: 28, q: "å›ºå®šåˆ†åŒºç®¡ç†ä¸­ï¼Œåˆ†åŒºä¸­æœªè¢«åˆ©ç”¨çš„ä¸€éƒ¨åˆ†åŒºåŸŸç§°ä¸º____ã€‚", ans: "å†…ç¢ç‰‡" },
    { id: 29, q: "äº§ç”Ÿæ­»é”çš„åŸå› å¯ä»¥å½’ç»“ä¸ºä¸¤ç‚¹:ç«äº‰èµ„æºå’Œ____éæ³•ã€‚", ans: "è¿›ç¨‹æ¨è¿›é¡ºåº" },
    { id: 30, q: "åœ¨å¯å˜åˆ†åŒºå­˜å‚¨ç®¡ç†ä¸­ï¼Œä¸»è¦é‡‡ç”¨____é‡å®šä½æ–¹å¼ã€‚", ans: "åŠ¨æ€" },
    { id: 31, q: "é¡µçš„å¤§å°æ˜¯ç”±____ç¡®å®šçš„ï¼Œæ®µçš„é•¿åº¦æ˜¯ç”¨æˆ·ç¨‹åºç¡®å®šçš„", ans: "ç³»ç»Ÿ" },
    { id: 32, q: "å¯å˜åˆ†åŒºç®¡ç†ä¸­ï¼Œå› ä¸ºåˆ†å‰²å¤ªå°è€Œæ— æ³•åˆ©ç”¨çš„ç©ºé—²åˆ†åŒºç§°ä¸º____ã€‚", ans: "å¤–ç¢ç‰‡" },
    { id: 33, q: "é“¶è¡Œå®¶ç®—æ³•ä¸»è¦ç”¨äº____ã€‚", ans: "æ­»é”é¿å…" },
    { id: 34, q: "å¤–éƒ¨å­˜å‚¨å™¨ä¸­çš„å­˜å‚¨å†…å®¹ä»¥ ____çš„å½¢å¼è¢«ç»„ç»‡åœ¨ä¸€èµ·ã€‚", ans: "æ–‡ä»¶" },
    { id: 35, q: "Pã€Væ“ä½œåŸè¯­æ˜¯å¯¹ ____æ‰§è¡Œçš„æ“ä½œï¼Œå…¶å€¼åªèƒ½ç”±Pã€Væ“ä½œæ”¹å˜ã€‚", ans: "ä¿¡å·é‡" },
    { id: 36, q: "å®ç°\"å®‰å…¨ç¯å¢ƒ\"çš„ä¸»è¦ç›®æ ‡æ˜¯____ã€æ•°æ®å®Œæ•´æ€§å’Œç³»ç»Ÿå¯ç”¨æ€§ã€‚", ans: "æ•°æ®æœºå¯†æ€§" },
    { id: 37, q: "æ“ä½œç³»ç»Ÿçš„ç‰¹å¾æ˜¯____ã€å…±äº«æ€§ã€è™šæ‹Ÿæ€§ã€å¼‚æ­¥æ€§ã€‚", ans: "å¹¶å‘æ€§" },
    { id: 38, q: "åˆ†é¡µç³»ç»Ÿä¸­ï¼Œåˆ†é¡µæ˜¯ç”± ____å®Œæˆçš„ã€‚", ans: "æ“ä½œç³»ç»Ÿ" },
    { id: 39, q: "å¹¶å‘è¿›ç¨‹ä¸­ä¸å…±äº«å˜é‡æœ‰å…³çš„ç¨‹åºæ®µè¢«ç§°ä¸º____ã€‚", ans: "ä¸´ç•ŒåŒº" },
    { id: 40, q: "ä¿¡ç®±é€šä¿¡æœºåˆ¶é€šå¸¸é‡‡ç”¨å‘é€åŸè¯­å’Œ____åŸè¯­æ¥å®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚", ans: "æ¥æ”¶" },
    { id: 41, q: "FCBçš„å…¨ç§°ä¸º____ã€‚", ans: "æ–‡ä»¶æ§åˆ¶å—" },
    { id: 42, q: "åˆ†æ®µç³»ç»Ÿä¸­ï¼Œåˆ†æ®µæ˜¯ç”± ____å®Œæˆçš„ã€‚", ans: "ç”¨æˆ·" },
    { id: 43, q: "çº¿ç¨‹çš„ç±»å‹åˆ†ä¸ºç”¨æˆ·çº§çº¿ç¨‹ã€____çº§çº¿ç¨‹å’Œæ··åˆå¼çº¿ç¨‹ã€‚", ans: "å†…æ ¸" },
    { id: 44, q: "è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†ä¸­ï¼Œè‹¥è®¿é—®çš„é¡µé¢æœªè£…å…¥å†…å­˜ï¼Œåˆ™ä¼šäº§ç”Ÿ____ã€‚", ans: "ç¼ºé¡µä¸­æ–­" },
    { id: 45, q: "å¤šå¤„ç†æœºOSä¸»è¦æœ‰3ç§ç±»å‹ï¼Œå…¶ä¸­è¾ƒæ˜“å®ç°çš„æ˜¯____ã€‚", ans: "ä¸»ä»å¼OS" },
    { id: 46, q: "____æ˜¯æ•°æ®çš„ä¸å¯åˆ†å‰²çš„æœ€å°å•ä½ã€‚", ans: "æ•°æ®é¡¹" },
    { id: 47, q: "å†…å­˜ç®¡ç†è¦è¾¾åˆ°çš„ç›®æ ‡ä¸ºåœ°å€ä¿æŠ¤å’Œ____ã€‚", ans: "åœ°å€é‡å®šä½" },
    { id: 48, q: "I/Oæ§åˆ¶æ–¹å¼åŒ…æ‹¬è½®è¯¢çš„å¯ç¼–ç¨‹I/Oæ–¹å¼ï¼Œä¸­æ–­çš„å¯ç¼–ç¨‹I/Oæ–¹å¼ï¼Œ____æ–¹å¼å’Œé€šé“æ§åˆ¶æ–¹å¼ã€‚", ans: "DMA" }
];

// å¤šé€‰é¢˜æ•°æ®å·²ç§»é™¤

// ä¿å­˜åŸå§‹æ•°æ®ä»¥ä¾¿æ¢å¤ï¼ˆé¡µé¢åŠ è½½åè®¾ç½®ï¼‰
const ORIGINAL_FILL = JSON.parse(JSON.stringify(fillBlankData));

// æ·±æ‹·è´è¾…åŠ©
function deepClone(obj) { return JSON.parse(JSON.stringify(obj)); }

// Fisher-Yates æ‰“ä¹±æ•°ç»„ï¼ˆè¿”å›æ–°æ•°ç»„ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„ï¼‰
function shuffleArray(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

// é‡æ–°æ¸²æŸ“è¯•å·ï¼šæ¸…ç©ºå®¹å™¨å¹¶æ ¹æ®å½“å‰ fillBlankData æ¸²æŸ“
function rerenderQuiz() {
    const sContainer = document.getElementById('single-choice-container');
    const navContainerSingle = document.getElementById('question-navigator-single');
    if (!sContainer || !navContainerSingle) return;

    sContainer.innerHTML = '';
    navContainerSingle.innerHTML = '';

    let globalIndex = 1;
    fillBlankData.forEach(item => {
        const card = createCard(item, 'text', 's_', globalIndex);
        sContainer.appendChild(card);
        navContainerSingle.appendChild(createNavButton(globalIndex, card.id, 'single'));
        globalIndex++;
    });

    // é‡æ–°ç»‘å®šå¿…è¦çš„è¡Œä¸º
    initListeners();
    updateProgressText();
    setupMobileNavigation();
}

// åº”ç”¨æ‰“ä¹±ï¼šmode = 'shuffleQuestions' | 'shuffleOptions' | 'shuffleBoth'
function applyShuffleMode(mode) {
    // åŸºäº ORIGINAL_FILL åšæ“ä½œï¼Œé¿å…é‡å¤å åŠ 
    fillBlankData = deepClone(ORIGINAL_FILL);

    if (mode === 'shuffleQuestions' || mode === 'shuffleBoth') {
        fillBlankData = shuffleArray(fillBlankData);
    }

    if (mode === 'shuffleOptions' || mode === 'shuffleBoth') {
        // No options in fill-blank mode, skip
    }

    rerenderQuiz();
}

function applyShuffle() {
    const sel = document.getElementById('shuffleMode');
    if (!sel) return;
    applyShuffleMode(sel.value);
}

function restoreOriginal() {
    fillBlankData = deepClone(ORIGINAL_FILL);
    rerenderQuiz();
}

// ================= JS æ ¸å¿ƒé€»è¾‘ =================

// åˆ›å»ºé¢˜ç›®å¡ç‰‡çš„é€šç”¨å‡½æ•°
function createCard(item, type, prefix, globalIndex) {
    const card = document.createElement('div');
    card.className = 'question-card';
    card.id = `q_${prefix}${item.id}`;
    card.dataset.qIndex = globalIndex;
    
    const tagLabel = type === 'text' ? 'å¡«ç©º' : (type === 'radio' ? 'å•é€‰' : 'å¤šé€‰');
    
    // è¾“å…¥æ¡†ç”Ÿæˆï¼ˆæ–‡æœ¬è¾“å…¥ï¼‰æˆ–é€‰é¡¹ç”Ÿæˆï¼ˆå•/å¤šé€‰ï¼‰
    let inputHtml = '';
    if (type === 'text') {
        inputHtml = `<div class="fill-in-input">
            <input type="text" name="${prefix}${item.id}" placeholder="è¯·å¡«å†™ç­”æ¡ˆ..." data-qindex="${globalIndex}" class="fill-input-field">
        </div>`;
    } else {
        inputHtml = '<div class="options-group">';
        if (item.options) {
            item.options.forEach(opt => {
                const optKey = opt.charAt(0);
                inputHtml += `
                    <label class="option-label">
                        <input type="${type}" name="${prefix}${item.id}" value="${optKey}" data-qindex="${globalIndex}">
                        <span class="checkmark"></span>
                        <span class="option-text">${opt}</span>
                    </label>
                `;
            });
        }
        inputHtml += '</div>';
    }

    card.innerHTML = `
        <div class="question-text">
            <span class="q-tag">${tagLabel}</span>${globalIndex}. ${item.q}
        </div>
        ${inputHtml}
        <div class="result-box" id="f_${prefix}${item.id}"></div>
    `;
    return card;
}

// åˆ›å»ºç­”é¢˜å¡å¯¼èˆªæŒ‰é’®
function createNavButton(index, targetId, type) {
    const button = document.createElement('a');
    button.href = `#${targetId}`;
    button.className = 'q-nav-button ' + (type === 'single' ? 'nav-single' : 'nav-multi');
    button.id = `nav_q_${index}`;
    button.innerText = index;
    // æŠŠå¯¼èˆªè¡Œä¸ºå°è£…ä¸ºå¯å¤ç”¨å‡½æ•°ï¼Œç”¨äº click å’Œ touchend
    const doNav = (e) => {
        if (e && e.preventDefault) {
            e.preventDefault();
            if (e.stopPropagation) e.stopPropagation();
        }
        console.log('[nav] clicked', index, targetId, 'isSmall=', (typeof isSmallScreen === 'function' ? isSmallScreen() : 'nofn'));
        const el = document.getElementById(targetId);
        if (!el) {
            console.warn('[nav] target not found', targetId);
            return;
        }

        // Helper: smooth-scroll to element using window.scrollTo with calculated top (more reliable on mobile)
        const scrollToElement = (element) => {
            try {
                const rect = element.getBoundingClientRect();
                const targetY = rect.top + (window.pageYOffset || document.documentElement.scrollTop || 0);
                // subtract a small offset to account for any fixed header (if exists)
                const header = document.querySelector('.header-hero');
                const headerHeight = header ? header.getBoundingClientRect().height : 0;
                const finalY = Math.max(0, targetY - headerHeight - 8);
                window.scrollTo({ top: finalY, behavior: 'smooth' });
            } catch (err) {
                try { element.scrollIntoView({ behavior: 'smooth', block: 'start' }); } catch (e) { console.warn('scroll fallback failed', e); }
            }
        };

        if (typeof isSmallScreen === 'function' && isSmallScreen()) {
            // æ ‡è®°ç”±å¯¼èˆªè§¦å‘çš„ä¾§æ å…³é—­ï¼Œé˜²æ­¢ setupMobileNavigation çš„å»¶è¿Ÿå…³é—­å†æ¬¡è§¦å‘å¹¶æ¢å¤æ»šåŠ¨ä½ç½®
            try { window._navCloseInProgress = Date.now(); } catch (e) { /* ignore */ }
            try { closeMobileSidebar(); console.log('[nav] closeMobileSidebar called'); } catch (err) { console.error(err); }

            const start = Date.now();
            const maxWait = 800;

            const tryScroll = () => {
                const body = document.body;
                if (!body.style.position || body.style.position === '') {
                    console.log('[nav] body unlocked, scrolling to', targetId);
                    scrollToElement(el);
                } else if (Date.now() - start < maxWait) {
                    requestAnimationFrame(tryScroll);
                } else {
                    console.log('[nav] timeout, forcing scroll to', targetId);
                    scrollToElement(el);
                }
            };

            setTimeout(tryScroll, 40);

            // åœ¨ä¸€æ®µæ—¶é—´åæ¸…é™¤æ ‡è®°
            setTimeout(() => { try { window._navCloseInProgress = 0; } catch (e) {} }, 1200);
        } else {
            console.log('[nav] desktop scroll to', targetId);
            scrollToElement(el);
        }
    };

    // ç»‘å®šäº‹ä»¶ï¼šclick ç”¨äºæ¡Œé¢å’Œéƒ¨åˆ†ç§»åŠ¨è®¾å¤‡ï¼Œtouchend å¸®åŠ©æ›´æ—©æ•è·è§¦æ‘¸äº¤äº’
    button.addEventListener('click', doNav, { passive: false });
    button.addEventListener('touchend', function(e){ doNav(e); }, { passive: false });
    return button;
}

// æ¸²æŸ“æ‰€æœ‰ç»„ä»¶
function renderQuiz() {
    const sContainer = document.getElementById('single-choice-container');
    const navContainerSingle = document.getElementById('question-navigator-single');
    
    let globalIndex = 1;

    // æ¸²æŸ“å¡«ç©ºé¢˜
    fillBlankData.forEach(item => {
        const card = createCard(item, 'text', 's_', globalIndex);
        sContainer.appendChild(card);
        navContainerSingle.appendChild(createNavButton(globalIndex, card.id, 'single'));
        globalIndex++;
    });
    
    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
    initListeners();
    // åˆå§‹è¿›åº¦
    updateProgressText();
    // å¯åŠ¨è®¡æ—¶å™¨
    startTimer();
}

// å¯åŠ¨è®¡æ—¶å™¨
let timerInterval = null;
function startTimer() {
    if (timerInterval) clearInterval(timerInterval);
    
    timerInterval = setInterval(() => {
        if (quizStartTime) {
            const elapsed = Math.floor((Date.now() - quizStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timerDisplay = document.getElementById('timerDisplay');
            if (timerDisplay) {
                timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
        }
    }, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡
}

// å®æ—¶æ›´æ–°ç­”é¢˜çŠ¶æ€å’Œè¿›åº¦
function updateQuestionStatus(qIndex, name) {
    const navButton = document.getElementById(`nav_q_${qIndex}`);
    const formInputs = document.querySelectorAll(`input[name="${name}"]`);
    let isAnswered = false;
    
    // æ£€æŸ¥è¯¥é¢˜æ˜¯å¦æœ‰ä»»ä½•é€‰é¡¹è¢«é€‰ä¸­æˆ–æ–‡æœ¬è¾“å…¥æ¡†æœ‰å€¼
    for (const input of formInputs) {
        if (input.type === 'text') {
            // æ–‡æœ¬è¾“å…¥æ¡†ï¼šæ£€æŸ¥æ˜¯å¦æœ‰éç©ºå€¼
            if (input.value.trim() !== '') {
                isAnswered = true;
                break;
            }
        } else {
            // å•é€‰/å¤šé€‰ï¼šæ£€æŸ¥æ˜¯å¦è¢«é€‰ä¸­
            if (input.checked) {
                isAnswered = true;
                break;
            }
        }
    }

    if (isAnswered) {
        navButton.classList.add('answered');
    } else {
        navButton.classList.remove('answered');
    }
    
    updateProgressText();
}

// æ›´æ–°è¿›åº¦æ–‡æœ¬
function updateProgressText() {
     const answeredCount = document.querySelectorAll('.q-nav-button.answered').length;
    const total = typeof fillBlankData !== 'undefined' ? fillBlankData.length : 0;
    document.getElementById('progress-text').innerText = `${answeredCount} / ${total} é¢˜å·²ä½œç­”`;
}


function initListeners() {
    const quizForm = document.getElementById('quizForm');
    if (!quizForm) return;
    // é˜²æ­¢é‡å¤ç»‘å®š
    if (quizForm._initBound) return;
    // ä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼Œç›‘å¬è¡¨å•å†…æ‰€æœ‰ input çš„å˜åŒ–
    quizForm.addEventListener('change', (event) => {
        const inputName = event.target.name;
        const qIndex = event.target.dataset.qindex;
        if (inputName && qIndex) {
            updateQuestionStatus(qIndex, inputName);
        }
    });
    // ä¸ºæ–‡æœ¬è¾“å…¥æ¡†æ·»åŠ  input äº‹ä»¶ç›‘å¬ï¼ˆç”¨äºå®æ—¶åé¦ˆï¼‰
    quizForm.addEventListener('input', (event) => {
        if (event.target.type === 'text') {
            const inputName = event.target.name;
            const qIndex = event.target.dataset.qindex;
            if (inputName && qIndex) {
                updateQuestionStatus(qIndex, inputName);
            }
        }
    });
    quizForm._initBound = true;
}

// å°†ç§’æ•°æ ¼å¼åŒ–ä¸º MM:SS æˆ– H:MM:SS
function formatTime(seconds) {
    if (seconds < 0) seconds = 0;
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    if (hours > 0) {
        return `${hours}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    } else {
        return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }
}

// æäº¤è¯„åˆ†é€»è¾‘ (å…¨å±€å‡½æ•°ï¼Œä¾› HTML ä¸­çš„ onclick è°ƒç”¨)
function submitQuiz() {
    let score = 0;
    let totalCorrect = 0;
    
    // æ•´åˆæ‰€æœ‰é¢˜ç›®æ•°æ®ï¼Œæ–¹ä¾¿ç»Ÿä¸€å¤„ç†ï¼ˆå¡«ç©ºé¢˜ï¼‰
    const allQuestions = fillBlankData.map((q, i) => ({ ...q, prefix: 's_', isMulti: false, index: i + 1 }));
    
    const rootStyle = getComputedStyle(document.documentElement);
    const successColor = rootStyle.getPropertyValue('--success').trim();
    const errorColor = rootStyle.getPropertyValue('--error').trim();
    
    // ç”¨äºä¿å­˜æœ¬æ¬¡ç­”é¢˜è®°å½•çš„æ•°ç»„
    const answerRecord = [];
    
    // æ¯é¢˜2åˆ†ï¼Œ48é¢˜å…±100åˆ†ï¼ˆå®é™…ä¸º96åˆ†ï¼Œéœ€è¦å¾®è°ƒï¼‰
    const pointsPerQuestion = 100 / fillBlankData.length;
    
    allQuestions.forEach(item => {
        const cardId = `q_${item.prefix}${item.id}`;
        const card = document.getElementById(cardId);
        const feedback = document.getElementById(`f_${item.prefix}${item.id}`);
        const navButton = document.getElementById(`nav_q_${item.index}`);
        
        // æ¸…é™¤æ—§çŠ¶æ€
        card.classList.remove('correct', 'incorrect');
        navButton.classList.remove('answered', 'correct', 'incorrect');
        feedback.style.display = 'block';

        let isCorrect = false;
        let userAnswer = null;

        // å¡«ç©ºé¢˜é€»è¾‘ï¼šè·å–æ–‡æœ¬è¾“å…¥å€¼å¹¶ä¸æ­£ç¡®ç­”æ¡ˆæ¯”è¾ƒï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
        const textInput = document.querySelector(`input[name="${item.prefix}${item.id}"][type="text"]`);
        userAnswer = textInput ? textInput.value.trim() : null;

        if (userAnswer && userAnswer !== '') {
            // æ”¯æŒå¤šä¸ªå¯èƒ½çš„ç­”æ¡ˆï¼Œç”¨ | åˆ†éš”ï¼ˆå¦‚æœé¢˜ç›®æœ‰å¤šä¸ªæ­£ç¡®ç­”æ¡ˆï¼‰
            const correctAnswers = item.ans.split('|').map(a => a.trim());
            isCorrect = correctAnswers.some(correct => 
                correct.toLowerCase() === userAnswer.toLowerCase()
            );
            
            if (isCorrect) {
                score += pointsPerQuestion;
                totalCorrect++;
            }
        }
        
        feedback.innerHTML = `<strong>${isCorrect ? 'âœ” å›ç­”æ­£ç¡®' : 'âœ˜ å›ç­”é”™è¯¯'}</strong><br>æ­£ç¡®ç­”æ¡ˆ: <b>${item.ans}</b><br>ä½ çš„ç­”æ¡ˆ: <b>${userAnswer || '(æœªå›ç­”)'}</b>`;
        
        // è®°å½•å¡«ç©ºç­”æ¡ˆ
        answerRecord.push({
            questionIndex: item.index,
            questionId: item.id,
            type: 'fillblank',
            correctAnswer: item.ans,
            userAnswer: userAnswer,
            isCorrect: isCorrect
        });
        
        // æ›´æ–°å¡ç‰‡å’Œå¯¼èˆªæŒ‰é’®çŠ¶æ€
        if (isCorrect) {
            card.classList.add('correct');
            navButton.classList.add('correct');
        } else {
            card.classList.add('incorrect');
            navButton.classList.add('incorrect');
        }
    });

    // ç¦ç”¨è¾“å…¥ï¼Œé˜²æ­¢é‡å¤æäº¤å’Œä¿®æ”¹
    document.querySelectorAll('#quizForm input').forEach(input => input.disabled = true);

    // åœæ­¢è®¡æ—¶å™¨
    if (timerInterval) clearInterval(timerInterval);

    // æ˜¾ç¤ºæœ€ç»ˆå¾—åˆ†
    const scoreDisplay = document.getElementById('finalScore');
    const progressText = document.getElementById('progress-text');
    
    scoreDisplay.style.display = 'block';
    // å››èˆäº”å…¥åˆ†æ•°ï¼Œæœ€å¤š100åˆ†
    const finalScore = Math.min(Math.round(score), 100);
    scoreDisplay.innerHTML = `${finalScore} <span style="font-size:0.5em;color:#666">/ 100</span>`;
    
    progressText.innerText = `æœ€ç»ˆå¾—åˆ†ï¼š${finalScore} åˆ†`;
    progressText.style.color = finalScore >= 60 ? successColor : errorColor;

    // è®¡ç®—ç­”é¢˜ç”¨æ—¶
    const endTime = Date.now();
    const timeTaken = quizStartTime ? Math.round((endTime - quizStartTime) / 1000) : 0; // è½¬æ¢ä¸ºç§’

    // ä¿å­˜æœ¬æ¬¡ç­”é¢˜è®°å½•ï¼ˆåŒ…å«å½“å‰æ‰“ä¹±æ¨¡å¼ï¼‰
    const modeEl = document.getElementById('shuffleMode');
    const currentMode = modeEl ? modeEl.value : 'original';
    saveQuizResult(finalScore, answerRecord, currentMode, timeTaken);

    // æ»šåŠ¨åˆ°é¡¶éƒ¨
    window.scrollTo({ top: 0, behavior: 'smooth' });
    alert(`äº¤å·æˆåŠŸï¼æ‚¨çš„æœ€ç»ˆå¾—åˆ†æ˜¯ï¼š${finalScore}åˆ†\nç­”é¢˜ç”¨æ—¶ï¼š${formatTime(timeTaken)}`);
}

// é‡ç½®é¡µé¢ (å…¨å±€å‡½æ•°ï¼Œä¾› HTML ä¸­çš„ onclick è°ƒç”¨)
function resetQuiz() {
    if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç­”æ¡ˆé‡ç½®è¯•å·å—ï¼Ÿ")) {
        quizStartTime = Date.now(); // é‡ç½®å¼€å§‹æ—¶é—´
        if (timerInterval) clearInterval(timerInterval); // æ¸…é™¤æ—§å®šæ—¶å™¨
        startTimer(); // é‡æ–°å¯åŠ¨è®¡æ—¶å™¨
        location.reload();
    }
}

// åˆå§‹åŒ–ä¾§æ æŠ˜å /å±•å¼€åŠŸèƒ½
function initSidebar() {
    const sidebar = document.getElementById('sidebar');
    const toggle = document.getElementById('sidebar-toggle');
    if (!sidebar || !toggle) return;

    // æ¢å¤ä¸Šæ¬¡çŠ¶æ€
    const collapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (collapsed) {
        sidebar.classList.add('collapsed');
        document.body.classList.add('sidebar-collapsed');
        toggle.setAttribute('aria-expanded', 'false');
    } else {
        sidebar.classList.remove('collapsed');
        document.body.classList.remove('sidebar-collapsed');
        toggle.setAttribute('aria-expanded', 'true');
    }

    // åœ¨ç§»åŠ¨ç«¯ç‚¹å‡»ä½¿ç”¨æŠ½å±‰é€»è¾‘ï¼Œåœ¨å¤§å±ä¿ç•™æŠ˜å é€»è¾‘
    toggle.addEventListener('click', (e) => {
        if (window.innerWidth <= 1000) {
            // ç§»åŠ¨ç«¯ï¼šåˆ‡æ¢æŠ½å±‰
            e.stopPropagation();
            toggleMobileSidebar();
            return;
        }

        // æ¡Œé¢ç«¯ï¼šæŠ˜å /å±•å¼€
        const isCollapsed = sidebar.classList.toggle('collapsed');
        document.body.classList.toggle('sidebar-collapsed', isCollapsed);
        toggle.setAttribute('aria-expanded', String(!isCollapsed));
        localStorage.setItem('sidebarCollapsed', String(isCollapsed));
    });
}

// ================= å†å²è®°å½•ç›¸å…³å‡½æ•° =================

// ä¿å­˜ç­”é¢˜ç»“æœåˆ°localStorageï¼ˆæœ€å¤šä¿å­˜10æ¡ï¼‰
function saveQuizResult(score, answerRecord, mode, timeTaken = 0) {
    const history = getQuizHistory();
    
    // åˆ›å»ºæ–°è®°å½•
    const newRecord = {
        id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
        score: score,
        mode: mode || 'original',
        date: new Date().toLocaleString('zh-CN'),
        timeTaken: timeTaken, // æ·»åŠ ç”¨æ—¶ï¼ˆç§’æ•°ï¼‰
        answers: answerRecord
    };
    
    // å°†æ–°è®°å½•æ·»åŠ åˆ°æœ€å‰é¢
    history.unshift(newRecord);
    
    // åªä¿ç•™æœ€è¿‘10æ¡è®°å½•
    if (history.length > 10) {
        history.splice(10);
    }
    
    // ä¿å­˜åˆ°localStorage
    localStorage.setItem('quizHistory', JSON.stringify(history));
}

// è·å–ç­”é¢˜å†å²è®°å½•ï¼ˆå®¹é”™ï¼šè§£æå¤±è´¥ä¼šè‡ªåŠ¨æ¸…ç©ºå†å²ï¼‰
function getQuizHistory() {
    const key = 'quizHistory';
    const historyJson = localStorage.getItem(key);
    if (!historyJson) return [];
    try {
        const parsed = JSON.parse(historyJson);
        // éªŒè¯æ•°æ®å®Œæ•´æ€§ï¼šæ¯æ¡è®°å½•éƒ½å¿…é¡»æœ‰ answers æ•°ç»„å’Œæ¯ä¸ª answer éƒ½æœ‰ options
        if (!Array.isArray(parsed)) return [];
        
        const validHistory = parsed.filter(record => {
            if (!record || typeof record !== 'object') return false;
            if (!Array.isArray(record.answers)) return false;
            // æ£€æŸ¥æ¯ä¸ª answer éƒ½æœ‰å¿…è¦å­—æ®µ
            return record.answers.every(answer => 
                answer && typeof answer === 'object' && Array.isArray(answer.options)
            );
        });
        
        // å¦‚æœæ•°æ®è¢«è¿‡æ»¤ï¼ˆåˆ é™¤äº†æ— æ•ˆè®°å½•ï¼‰ï¼Œæ›´æ–°å­˜å‚¨
        if (validHistory.length !== parsed.length) {
            console.warn(`å‘ç° ${parsed.length - validHistory.length} æ¡æ— æ•ˆè®°å½•ï¼Œå·²æ¸…é™¤`);
            localStorage.setItem(key, JSON.stringify(validHistory));
        }
        
        return validHistory;
    } catch (err) {
        console.warn('quizHistory è§£æå¤±è´¥ï¼Œå·²æ¸…ç©ºå†å²è®°å½•', err);
        localStorage.removeItem(key);
        return [];
    }
}

// æ˜¾ç¤ºå†å²è®°å½•æ¨¡æ€æ¡†
function showHistory() {
    console.log('showHistory å‡½æ•°è¢«è°ƒç”¨');
    try {
        const modal = document.getElementById('historyModal');
        const historyList = document.getElementById('historyList');
        
        if (!modal) {
            console.error('æ‰¾ä¸åˆ° historyModal å…ƒç´ ');
            alert('æ— æ³•æ‰“å¼€å†å²è®°å½•ï¼šæ‰¾ä¸åˆ°æ¨¡æ€æ¡†å…ƒç´ ');
            return;
        }
        
        if (!historyList) {
            console.error('æ‰¾ä¸åˆ° historyList å…ƒç´ ');
            alert('æ— æ³•æ‰“å¼€å†å²è®°å½•ï¼šæ‰¾ä¸åˆ°åˆ—è¡¨å…ƒç´ ');
            return;
        }
        
        const history = getQuizHistory();
        
        // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
        if (history.length === 0) {
            historyList.innerHTML = '<div style="text-align: center; color: var(--text-sub); padding: 40px;">æš‚æ— ç­”é¢˜è®°å½•</div>';
        } else {
            historyList.innerHTML = history.map((record, index) => {
                // ç»Ÿè®¡è¿™æ¬¡ç­”é¢˜çš„æ­£ç¡®é¢˜æ•°
                const correctCount = record.answers ? record.answers.filter(a => a.isCorrect).length : 0;
                const totalCount = record.answers ? record.answers.length : 0;
                
                // æ ¼å¼åŒ–ç”¨æ—¶æ˜¾ç¤º
                const timeDisplay = record.timeTaken ? ` Â· ç”¨æ—¶ ${formatTime(record.timeTaken)}` : '';
                
                // ç”Ÿæˆè¯¦ç»†ç­”æ¡ˆåˆ—è¡¨
                let answersHtml = '';
                if (Array.isArray(record.answers)) {
                    answersHtml = record.answers.map(answer => {
                        // æ ¼å¼åŒ–ç”¨æˆ·ç­”æ¡ˆ
                        let userAnswerDisplay = 'æœªä½œç­”';
                        if (answer.userAnswer) {
                            if (Array.isArray(answer.userAnswer)) {
                                userAnswerDisplay = answer.userAnswer.join('');
                            } else {
                                userAnswerDisplay = answer.userAnswer;
                            }
                        }
                        
                        // æ ¼å¼åŒ–æ­£ç¡®ç­”æ¡ˆ
                        let correctAnswerDisplay = '';
                        if (Array.isArray(answer.correctAnswer)) {
                            correctAnswerDisplay = answer.correctAnswer.join('');
                        } else {
                            correctAnswerDisplay = answer.correctAnswer;
                        }
                        
                        const resultColor = answer.isCorrect ? 'var(--success)' : 'var(--error)';
                        const resultText = answer.isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯';
                        
                        return `
                            <div style="background: var(--bg-body); padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid ${resultColor};">
                                <div style="font-weight: 600; margin-bottom: 6px; color: var(--text-main);">ç¬¬ ${answer.questionIndex} é¢˜</div>
                                <div style="font-size: 0.9rem; color: var(--text-sub); margin-bottom: 4px;">
                                    <span style="display: inline-block; padding: 2px 8px; background: var(--primary-light); border-radius: 4px; margin-right: 8px;">
                                        ä½ çš„ç­”æ¡ˆ: <strong>${userAnswerDisplay}</strong>
                                    </span>
                                </div>
                                <div style="font-size: 0.9rem; color: var(--text-sub); margin-bottom: 4px;">
                                    <span style="display: inline-block; padding: 2px 8px; background: #f0f0f0; border-radius: 4px; margin-right: 8px;">
                                        æ­£ç¡®ç­”æ¡ˆ: <strong>${correctAnswerDisplay}</strong>
                                    </span>
                                </div>
                                <div style="font-size: 0.9rem; color: ${resultColor}; font-weight: 600;">
                                    ${resultText}
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                // æ˜¾ç¤ºä¿å­˜æ—¶çš„æ‰“ä¹±æ¨¡å¼ï¼ˆè‹¥æœ‰ï¼‰
                const modeMap = {
                    shuffleQuestions: 'æ‰“ä¹±é¢˜åºï¼ˆä»…é¢˜åºï¼‰',
                    shuffleOptions: 'æ‰“ä¹±é€‰é¡¹ï¼ˆåºå·å›ºå®šï¼‰',
                    shuffleBoth: 'é¢˜åº + é€‰é¡¹ï¼ˆå…¨éƒ¨æ‰“ä¹±ï¼‰',
                    original: 'æœªæ‰“ä¹±'
                };
                const recordModeDisplay = modeMap[record.mode] || (record.mode ? record.mode : 'æœªæ‰“ä¹±');

                return `
                    <div class="history-item">
                        <div class="history-item-header">
                            <div>
                                <div class="history-item-title">ç¬¬ ${history.length - index} æ¬¡ç­”é¢˜</div>
                                <div class="history-item-date">${record.date}${timeDisplay}</div>
                                <div style="font-size:0.9rem;color:var(--text-sub);margin-top:6px;">æ‰“ä¹±æ¨¡å¼ï¼š<strong style="color:var(--primary);">${recordModeDisplay}</strong></div>
                                <div style="font-size: 0.85rem; color: var(--text-sub); margin-top: 4px;">
                                    ç­”å¯¹ ${correctCount}/${totalCount} é¢˜
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <div class="history-item-score">${record.score} åˆ†</div>
                                <button class="history-item-delete" onclick="deleteHistoryItem(${record.id})">åˆ é™¤</button>
                            </div>
                        </div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                            <details style="cursor: pointer;">
                                <summary style="color: var(--primary); font-weight: 600; margin-bottom: 8px;">
                                    å±•å¼€æŸ¥çœ‹è¯¦ç»†ç­”é¢˜æƒ…å†µ
                                </summary>
                                <div style="margin-top: 12px;">
                                    ${answersHtml}
                                </div>
                            </details>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // æ˜¾ç¤ºé€‰é¡¹ç»Ÿè®¡ï¼ˆä½¿ç”¨try-catchç¡®ä¿å³ä½¿å‡ºé”™ä¹Ÿèƒ½æ˜¾ç¤ºæ¨¡æ€æ¡†ï¼‰
        try {
            updateOptionStats(history);
        } catch (err) {
            console.error('æ›´æ–°é€‰é¡¹ç»Ÿè®¡æ—¶å‡ºé”™:', err);
            const optionStatsEl = document.getElementById('optionStats');
            if (optionStatsEl) {
                optionStatsEl.innerHTML = '<div style="color: var(--error); padding: 10px;">ç»Ÿè®¡åŠŸèƒ½æš‚æ—¶æ— æ³•ä½¿ç”¨</div>';
            }
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        modal.style.display = 'block';
    } catch (err) {
        console.error('showHistory å‡½æ•°æ‰§è¡Œå‡ºé”™:', err);
        alert('æ‰“å¼€å†å²è®°å½•æ—¶å‡ºé”™: ' + err.message);
    }
}

// å…³é—­å†å²è®°å½•æ¨¡æ€æ¡†
function closeHistory() {
    const modal = document.getElementById('historyModal');
    if (modal) modal.style.display = 'none';
}

// åˆ é™¤å•æ¡å†å²è®°å½•
function deleteHistoryItem(id) {
    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
        const history = getQuizHistory();
        const filteredHistory = history.filter(record => record.id !== id);
        localStorage.setItem('quizHistory', JSON.stringify(filteredHistory));
        showHistory(); // åˆ·æ–°æ˜¾ç¤º
    }
}

// æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•
function clearAllHistory() {
    if (confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰ç­”é¢˜è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        localStorage.removeItem('quizHistory');
        showHistory(); // åˆ·æ–°æ˜¾ç¤º
    }
}

// æ›´æ–°é€‰é¡¹æ­£ç¡®ç‡ç»Ÿè®¡
function updateOptionStats(history) {
    const optionStatsEl = document.getElementById('optionStats');
    if (!optionStatsEl) {
        console.warn('æ‰¾ä¸åˆ° optionStats å…ƒç´ ');
        return;
    }
    
    if (history.length === 0) {
        optionStatsEl.innerHTML = '';
        return;
    }
    
    // ç»Ÿè®¡æ¯ä¸ªé€‰é¡¹çš„é€‰æ‹©æ¬¡æ•°å’Œæ­£ç¡®æ¬¡æ•°
    // æ ¼å¼ï¼š{ "questionIndex_optionKey": { questionIndex, option, selectedCount, correctCount } }
    const optionStats = {};
    
    // éå†æ‰€æœ‰å†å²è®°å½•
    history.forEach(record => {
        // æ£€æŸ¥ answers å­—æ®µæ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ•°ç»„
        if (!Array.isArray(record.answers)) {
            console.warn('è®°å½•ä¸­ç¼ºå°‘ answers å­—æ®µæˆ–ä¸æ˜¯æ•°ç»„:', record);
            return;
        }
        
        record.answers.forEach(answer => {
            // æ£€æŸ¥ options å­—æ®µæ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ•°ç»„ï¼ˆé˜²æ­¢æ—§è®°å½•æ²¡æœ‰æ­¤å­—æ®µï¼‰
            if (!Array.isArray(answer.options)) {
                console.warn('ç­”æ¡ˆè®°å½•ä¸­ç¼ºå°‘ options å­—æ®µ:', answer);
                return;
            }
            
            // éå†è¯¥é¢˜çš„æ‰€æœ‰é€‰é¡¹
            answer.options.forEach((opt) => {
                const optionKey = opt.charAt(0); // A, B, C, Dç­‰
                const questionKey = `${answer.questionIndex}_${optionKey}`;
                
                // åˆå§‹åŒ–ç»Ÿè®¡å¯¹è±¡
                if (!optionStats[questionKey]) {
                    optionStats[questionKey] = {
                        questionIndex: answer.questionIndex,
                        option: optionKey,
                        selectedCount: 0,
                        correctCount: 0
                    };
                }
                
                // ç»Ÿè®¡é€‰æ‹©æ¬¡æ•°å’Œæ­£ç¡®æ¬¡æ•°
                if (answer.type === 'single') {
                    // å•é€‰é¢˜ï¼šå¦‚æœç”¨æˆ·é€‰æ‹©äº†è¯¥é€‰é¡¹
                    if (answer.userAnswer === optionKey) {
                        optionStats[questionKey].selectedCount++;
                        // å¦‚æœç”¨æˆ·ç­”å¯¹äº†ï¼ˆå³é€‰æ‹©çš„é€‰é¡¹æ˜¯æ­£ç¡®ç­”æ¡ˆï¼‰ï¼Œåˆ™æ­£ç¡®æ¬¡æ•°+1
                        if (answer.isCorrect) {
                            optionStats[questionKey].correctCount++;
                        }
                    }
                } else {
                    // å¤šé€‰é¢˜ï¼šå¦‚æœç”¨æˆ·é€‰æ‹©äº†è¯¥é€‰é¡¹
                    if (answer.userAnswer && Array.isArray(answer.userAnswer) && answer.userAnswer.includes(optionKey)) {
                        optionStats[questionKey].selectedCount++;
                        // å¦‚æœç”¨æˆ·ç­”å¯¹äº†æ•´ä¸ªé¢˜ç›®ï¼Œä¸”è¯¥é€‰é¡¹æ˜¯æ­£ç¡®ç­”æ¡ˆçš„ä¸€éƒ¨åˆ†ï¼Œåˆ™æ­£ç¡®æ¬¡æ•°+1
                        if (answer.isCorrect && Array.isArray(answer.correctAnswer) && answer.correctAnswer.includes(optionKey)) {
                            optionStats[questionKey].correctCount++;
                        }
                    }
                }
            });
        });
    });
    
    // è®¡ç®—æ­£ç¡®ç‡å¹¶ç”Ÿæˆç»Ÿè®¡HTML
    let statsHtml = '<h3>é€‰é¡¹æ­£ç¡®ç‡åˆ†æï¼ˆä»…æ˜¾ç¤ºæœ‰é€‰æ‹©è®°å½•çš„é€‰é¡¹ï¼‰</h3><div class="stats-grid">';
    
    // è¿‡æ»¤å‡ºæœ‰é€‰æ‹©è®°å½•çš„é€‰é¡¹ï¼Œå¹¶æŒ‰é¢˜ç›®å’Œé€‰é¡¹æ’åº
    const statsArray = Object.values(optionStats)
        .filter(stat => stat.selectedCount > 0)
        .sort((a, b) => {
            if (a.questionIndex !== b.questionIndex) {
                return a.questionIndex - b.questionIndex;
            }
            return a.option.localeCompare(b.option);
        });
    
    if (statsArray.length === 0) {
        statsHtml += '<div style="text-align: center; color: var(--text-sub); padding: 20px;">æš‚æ— ç»Ÿè®¡æ•°æ®</div>';
    } else {
        statsArray.forEach(stat => {
            const accuracy = stat.selectedCount > 0 
                ? ((stat.correctCount / stat.selectedCount) * 100).toFixed(1) 
                : 0;
            const accuracyColor = parseFloat(accuracy) >= 50 ? 'var(--success)' : 'var(--error)';
            statsHtml += `
                <div class="stat-item">
                    <div class="stat-item-label">ç¬¬${stat.questionIndex}é¢˜ - é€‰é¡¹${stat.option}</div>
                    <div class="stat-item-value" style="color: ${accuracyColor}">æ­£ç¡®ç‡: ${accuracy}%</div>
                    <div style="font-size: 0.85rem; color: var(--text-sub); margin-top: 4px;">
                        é€‰æ‹©${stat.selectedCount}æ¬¡ï¼Œæ­£ç¡®${stat.correctCount}æ¬¡
                    </div>
                </div>
            `;
        });
    }
    
    statsHtml += '</div>';
    if (optionStatsEl) {
        optionStatsEl.innerHTML = statsHtml;
    }
}

// ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
document.addEventListener('click', function(event) {
    const modal = document.getElementById('historyModal');
    if (modal && event.target === modal) {
        closeHistory();
    }
});

// ç¡®ä¿å‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸå¯ç”¨
window.showHistory = showHistory;
window.closeHistory = closeHistory;
window.deleteHistoryItem = deleteHistoryItem;
window.clearAllHistory = clearAllHistory;

// ================= æ‰‹æœºç«¯ç­”é¢˜å¡æ§åˆ¶ =================

// æ£€æŸ¥æ˜¯å¦ä¸ºå°å±å¹•
function isSmallScreen() {
    return window.innerWidth <= 1000;
}

// åˆ‡æ¢æ‰‹æœºç«¯ç­”é¢˜å¡æ˜¾ç¤º
function toggleMobileSidebar() {
    const sidebar = document.getElementById('sidebar');
    const mobileBtn = document.getElementById('mobileAnswerCardBtn');
    
    if (!sidebar) return;
    
    const isOpen = sidebar.classList.contains('mobile-open');
    
    if (isOpen) {
        closeMobileSidebar();
    } else {
        openMobileSidebar();
    }
}

// æ‰“å¼€æ‰‹æœºç«¯ç­”é¢˜å¡
function openMobileSidebar() {
    const sidebar = document.getElementById('sidebar');
    const body = document.body;
    
    if (!sidebar) return;
    
    sidebar.classList.add('mobile-open');
    body.classList.add('sidebar-open');

    // ä¿å­˜æ»šåŠ¨ä½ç½®å¹¶ç¦æ­¢é¡µé¢æ»šåŠ¨ï¼ˆä»¥é¿å…é¡µé¢è¢«æŒ¤åŠ¨ï¼‰
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop || 0;
    body.dataset.scrollTop = scrollTop;
    body.style.position = 'fixed';
    body.style.top = `-${scrollTop}px`;
    body.style.left = '0';
    body.style.right = '0';
    body.style.width = '100%';

    // æ·»åŠ å…¨å±€å…³é—­äº‹ä»¶ï¼ˆç‚¹å‡»ä¾§æ å¤–æˆ–æŒ‰ ESC å…³é—­ï¼‰
    setTimeout(() => {
        document.addEventListener('click', handleMobileSidebarClose);
        document.addEventListener('keydown', handleMobileSidebarKeydown);
    }, 50);
}

// å…³é—­æ‰‹æœºç«¯ç­”é¢˜å¡
function closeMobileSidebar() {
    const sidebar = document.getElementById('sidebar');
    const body = document.body;
    
    if (!sidebar) return;
    
    sidebar.classList.remove('mobile-open');
    body.classList.remove('sidebar-open');

    // ç§»é™¤å…¨å±€äº‹ä»¶ç›‘å¬
    document.removeEventListener('click', handleMobileSidebarClose);
    document.removeEventListener('keydown', handleMobileSidebarKeydown);

    // æ¢å¤é¡µé¢æ»šåŠ¨å’Œæ»šåŠ¨ä½ç½®
    const prevScroll = parseInt(body.dataset.scrollTop || 0);
    body.style.position = '';
    body.style.top = '';
    body.style.left = '';
    body.style.right = '';
    body.style.width = '';
    if (!Number.isNaN(prevScroll) && prevScroll > 0) {
        window.scrollTo(0, prevScroll);
    }
}

// å¤„ç†è’™å±‚ç‚¹å‡»å…³é—­
function handleMobileSidebarClose(event) {
    const sidebar = document.getElementById('sidebar');
    const mobileBtn = document.getElementById('mobileAnswerCardBtn');
    const mobileClose = document.getElementById('mobileCloseBtn');

    // å¦‚æœç‚¹å‡»åœ¨sidebaræˆ–mobileBtnä¸Šï¼Œä¸å…³é—­
    if (sidebar && sidebar.contains(event.target)) return;
    if (mobileBtn && mobileBtn.contains(event.target)) return;
    if (mobileClose && mobileClose.contains(event.target)) return;

    // æ£€æŸ¥ç‚¹å‡»æ˜¯å¦åœ¨è’™å±‚ä¸Š
    const body = document.body;
    if (body.classList.contains('sidebar-open')) {
        closeMobileSidebar();
    }
}

function handleMobileSidebarKeydown(event) {
    if (event.key === 'Escape' || event.key === 'Esc') {
        closeMobileSidebar();
    }
}

// ç­”é¢˜å¡å¯¼èˆªæŒ‰é’®ç‚¹å‡»æ—¶è‡ªåŠ¨å…³é—­æ‰‹æœºç‰ˆç­”é¢˜å¡
function setupMobileNavigation() {
    // å§‹ç»ˆç»‘å®šï¼Œç‚¹å‡»å¯¼èˆªåè‹¥ä¸ºç§»åŠ¨ç«¯åˆ™å»¶è¿Ÿå…³é—­æŠ½å±‰ä»¥å…è®¸æ»šåŠ¨åŠ¨ç”»å®Œæˆ
    const navButtons = document.querySelectorAll('.q-nav-button');
    function mobileNavHandler() {
        console.log('[mobileNavHandler] fired');
        // å¦‚æœè¿‘æœŸæœ‰å¯¼èˆªè§¦å‘çš„ä¾§æ å…³é—­æ ‡è®°ï¼Œåˆ™å¿½ç•¥è¿™ä¸ªå»¶è¿Ÿå…³é—­ï¼ˆé¿å…è¦†ç›–æ»šåŠ¨ï¼‰
        if (window._navCloseInProgress && (Date.now() - window._navCloseInProgress) < 1200) {
            console.log('[mobileNavHandler] suppressed by navCloseInProgress');
            return;
        }
        if (isSmallScreen()) {
            console.log('[mobileNavHandler] mobile detected, will close sidebar');
            setTimeout(() => { closeMobileSidebar(); console.log('[mobileNavHandler] sidebar closed'); }, 300);
        }
    }
    navButtons.forEach(btn => {
        btn.removeEventListener('click', mobileNavHandler);
        btn.addEventListener('click', mobileNavHandler);
        // å…¼å®¹è§¦å±è®¾å¤‡ï¼šå½“ touchend å‘ç”Ÿæ—¶ä¹Ÿè§¦å‘ç§»åŠ¨ç«¯å…³é—­è¡Œä¸º
        btn.removeEventListener('touchend', mobileNavHandler);
        btn.addEventListener('touchend', mobileNavHandler, { passive: true });
    });
}

// åˆå§‹åŒ–æ‰‹æœºç«¯ç­”é¢˜å¡æ˜¾ç¤º/éšè—æŒ‰é’®
function initMobileAnswerCardBtn() {
    const mobileBtn = document.getElementById('mobileAnswerCardBtn');
    if (!mobileBtn) return;
    
    // æ£€æŸ¥å±å¹•å¤§å°ï¼Œå†³å®šæ˜¯å¦æ˜¾ç¤ºæŒ‰é’®
    function updateBtnVisibility() {
        const mobileClose = document.getElementById('mobileCloseBtn');
        if (isSmallScreen()) {
            mobileBtn.style.display = 'flex';
            if (mobileClose) mobileClose.style.display = 'flex';
        } else {
            mobileBtn.style.display = 'none';
            if (mobileClose) mobileClose.style.display = 'none';
            closeMobileSidebar(); // å¤§å±å¹•æ—¶å…³é—­mobileä¾§æ 
        }
    }
    
    // åˆå§‹æ£€æŸ¥
    updateBtnVisibility();
    
    // ç›‘å¬çª—å£resize
    window.addEventListener('resize', updateBtnVisibility);
}

// æ¸…ç†æŸåçš„å†å²æ•°æ®ï¼ˆå¯åœ¨æ§åˆ¶å°è°ƒç”¨ï¼‰
window.cleanCorruptedHistory = function() {
    const key = 'quizHistory';
    localStorage.removeItem(key);
    console.log('å·²æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•');
    alert('å·²æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•ï¼Œè¯·é‡æ–°åŠ è½½é¡µé¢ã€‚');
    location.reload();
};

// å¯¼å‡ºæ‰‹æœºç­”é¢˜å¡å‡½æ•°åˆ°å…¨å±€
window.toggleMobileSidebar = toggleMobileSidebar;
window.closeMobileSidebar = closeMobileSidebar;
window.openMobileSidebar = openMobileSidebar;

// ç¡®ä¿å†å²è®°å½•å‡½æ•°åœ¨å…¨å±€å¹¶ç»‘å®šæŒ‰é’®ç‚¹å‡»ï¼ˆå…¼å®¹ä¸åŒç¯å¢ƒï¼‰
try {
    window.showHistory = showHistory;
    const hb = document.getElementById('btnShowHistory');
    if (hb) {
        hb.removeEventListener('click', showHistory);
        hb.addEventListener('click', showHistory);
    }
} catch (e) { console.warn('ç»‘å®šå†å²æŒ‰é’®å¤±è´¥', e); }

// åˆå§‹åŒ–
window.onload = function() { 
    quizStartTime = Date.now(); // è®°å½•ç­”é¢˜å¼€å§‹æ—¶é—´
    renderQuiz(); 
    initSidebar(); 
    initMobileAnswerCardBtn();
    setupMobileNavigation();
};
    </script> 
</body>

</html>
